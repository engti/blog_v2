<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Adobe Analytics API: Automated Segment Generation</title>
  <meta name="author" content="" />

  
  
<meta name="google-site-verification" content="yQpq4UWIk3W1WvRms5c3xtbqpPm_zDCEWq1U6dSATtM" />


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N6Z7DW8');</script>


  
  <meta name="keywords" content="analytics">	
  

  
  <meta name="description" content="Auto generate segments in Adobe Analytics at scale.">
  

  <meta name="generator" content="Hugo 0.31.1" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.marsala.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon3.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-icon-57x57.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="DataSea Blog">

  
  <meta property="og:title" content="Adobe Analytics API: Automated Segment Generation" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://blog.datasea.in/" />
  <meta property="og:image" content="https://blog.datasea.in/img/portfolio-2.jpg" />
  <meta property="og:description" content="Digital Analytics Blog: A walk through of site analytics topics including tagging, reporting and personalisation.   " />
  <meta property="fb:app_id" content="2033742746906998" />
  

  
  <link rel="stylesheet" href="/css/solarized-dark.css">
  <script src="/css/solarized-dark.css"></script>
  

   

      
      <script src="/js/highlight.pack.localised.v3.js"></script>

      <script>
        hljs.initHighlightingOnLoad();
      </script>
       
</head>


  <body>

    <div id="all">

        <header>

          
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6Z7DW8"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    
<div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/LogoMakr.png" alt="Adobe Analytics API: Automated Segment Generation logo" class="hidden-xs hidden-sm">
                    <img src="/img/LogoMakr-small.png" alt="Adobe Analytics API: Automated Segment Generation logo" class="visible-xs visible-sm">
                    <span class="sr-only">Adobe Analytics API: Automated Segment Generation - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/">Home</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">Blog</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/faq/">FAQ</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">Contact</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Adobe Analytics API: Automated Segment Generation</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">By <a href="#">Robin Browne</a> | December 26, 2017</p>

                        <div id="post-content">
                          <p>For any given site, you would typically have many content groups. For example, you are a car manufacturer, and your site has car models that covers a range in the market. How would you see the overlap in interest between your different car models?</p>
<p>Adobe Analytics’ workspace feature allows you to create segment overlap report to see how the users are converging. But unfortunately, you can only do 3 segments, and cannot easily generate <em>n</em> combinations of segments.</p>
<div class="img-outline">
<img src="/img/adobe_segment_post/adobe_workspace.PNG" width="80%" style="display: block; margin: auto;" />
</div>
<div id="problem-statement" class="section level4">
<h4>Problem Statement</h4>
<ul>
<li>For a site with <strong><em>n</em></strong> products</li>
<li>Show the most popular combination of top y products viewed within a visit
<ul>
<li>And by combination I don’t mean within the same page, what I am looking for is within the same visit in any order</li>
</ul></li>
</ul>
<p>A quick way to do this is to use the segment overlap feature Adobe Analytics. But you can only do 2 segments at a time. I wanted something that scales up much better and can do things like find the overlap for the top 10, 20, n products. And should be easily adaptable across projects.</p>
</div>
<div id="what-it-looks-like-but-is-not" class="section level4">
<h4>What it looks like, but is not</h4>
<p>Also as far as I am aware, this is different from Product Affinity because that is done at a transaction level, and all the products are contained within the same call from the Thank You page. What I was looking for was product viewed separately somewhere within the same visit [or even visitor level if need be].</p>
</div>
<div id="result" class="section level4">
<h4>Result</h4>
<p>Let me showcase the results of the scripts that I have built first:</p>
<div class="img-outline">
<img src="/img/adobe_segment_post/adobe_segment_result.PNG" style="display: block; margin: auto;" />
</div>
<p><br></p>
<ul>
<li>The above contains a simulated result based on real test runs</li>
<li>The overlap percentage shows the percentage of visits in which both products were seen</li>
<li>As you can see the <strong>product8</strong> model shows the highest overlap with other models
<ul>
<li>It’s an SUV with an accessible price range</li>
<li>It’s associated models seem to be sedans and cross over vehicles below its price range</li>
<li>So one observation could be that, this is a prime target for upselling</li>
</ul></li>
</ul>
</div>
<div id="how-to-use-it-for-your-projects" class="section level4">
<h4>How to Use it for your Projects</h4>
<ul>
<li>The solution is created in R</li>
<li>The script and a guide are contained at this Github <a href="https://github.com/engti/analytics_segment_overlap">link</a></li>
</ul>
<p>I have put it up as a Github project, so that you can easily pull it using RStudio. A handy guide is to be found <a href="https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN">here</a>.</p>
<p>Do note: Since it’s creating overlapping segments it takes a while to run. For instance, for 10 products it needs to make 44 API calls, for 20 products 188 API calls and so on. So if you increase the number of products, the number of requests scales exponentially.</p>
</div>
<div id="the-code" class="section level4">
<h4>The Code</h4>
<p>First we load the libraries</p>
<pre class="r"><code>  # load library ----
    library(tidyverse)
    library(RSiteCatalyst)
    library(jsonlite)</code></pre>
</div>
<div id="authenticate-with-adobe-analytics" class="section level4">
<h4>Authenticate with Adobe Analytics</h4>
<p>The following function from <strong>RSiteCatalyst</strong> allows yout to authenticate against your Adobe account credentials.</p>
<pre class="r"><code>  SCAuth(&quot;your api user id&quot;,&quot;your api passphrase&quot;)</code></pre>
<p>If you have admin access to Adobe Analytics, it’ll be available in your user profile page. Otherwise, ask your account admin to add you to the Web Services API group.</p>
</div>
<div id="define-metadata" class="section level4">
<h4>Define Metadata</h4>
<p>This is a simple showcase, and as such only 2 things are defined here:</p>
<pre class="r"><code>  # define metadata ----
  date_range  &lt;- list(
    &quot;start&quot; = &quot;2017-12-03&quot;,
    &quot;end&quot; = &quot;2017-12-09&quot;
  )
  TRUE
  
  # define the report suite to pull data from
  rsid &lt;- &quot;xxxxxxx-xx-x&quot;</code></pre>
</div>
<div id="defining-the-segment-ingredients" class="section level4">
<h4>Defining the segment ingredients</h4>
<p>The whole idea is to dynamically generate segments. In that case, what are your ingredients? In this particular case, we have our model names stored in an <em>eVar</em>. So we need the top models for the time range defined. We simply make a <em>QueueRanked</em> report which tells us the <em>top <strong>n</strong> </em> models which we can use to generate the overlapping segment conditions.</p>
<pre class="r"><code># get ingredients for segment ----
  # get car model name in this instance
  product_id &lt;- QueueRanked(
    reportsuite.id = rsid,
    date.from = date_range$start,
    date.to = date_range$end,
    metrics = &quot;visits&quot;,
    elements = &quot;evarX&quot;,
    top = 10
  )  </code></pre>
</div>
<div id="segment-overlap-api-request" class="section level4">
<h4>Segment Overlap API request</h4>
<p>Now that we know our top models, we want to create segments for the top combinations. We’re creating a series of segments with <em>Model A</em> + <em>Model B</em> in them. We loop through the model combinations, be careful, the number of combinations increases exponentially so it would take a lot of time to execute if you have a large set of inputs.</p>
<pre class="r"><code># calculate overlap in visits for each model combination
  for (i in 1:(nrow(product_id)-1)) {
    for (j in (i + 1) : nrow(product_id)) {
      product_segment &lt;- c(product_id$name[i],product_id$name[j])
      # create segment
      mySegment&lt;- list(container=list(type=unbox(&quot;visits&quot;),
                                      rules = data.frame(
                                        name = &quot;models&quot;,
                                        element = &quot;evar7&quot;,
                                        operator = &quot;contains&quot;,
                                        value = product_segment
                                      )))
      
      df2 &lt;- QueueOvertime(
        reportsuite.id =  rsid,
        date.from = date_range$start,
        date.to = date_range$end,
        metrics = &quot;visits&quot;,
        date.granularity = &quot;week&quot;,
        segment.inline =  mySegment)
      
      df3 &lt;- df2 %&gt;% select(visits) %&gt;%
        mutate(
          model1 = product_id$name[i],
          model2 = product_id$name[j]
        ) %&gt;% select(model1,model2,visits)
      
      if(i == 1 &amp; j == 2){
        car_segment_data &lt;- df3
      }else{
        car_segment_data &lt;- rbind(car_segment_data,df3)
      }
   
    }
    paste0(i,j)
  }</code></pre>
</div>
<div id="results" class="section level4">
<h4>Results</h4>
<p>I have shown the resulting image on top of the blog.</p>
</div>
<div id="how-you-can-help" class="section level4">
<h4>How you can help</h4>
<p>Just by itself, the report only showcases some correlation. It doesn’t give you supporting evidence for why such a correlation exists. If we can automate report pull from other elements it might make the report more meaningful. And since it’s on Github, you can submit pull requests to enhance the script.</p>
</div>
<div id="current-to-dos" class="section level4">
<h4>Current To Dos</h4>
<ul>
<li>The final percentage calculation is currently done manually, automate that in next build</li>
<li>Visualise the results better within R</li>
<li>Make it more plug and play for different projects</li>
</ul>
</div>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-blog-datasea-in" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="https://blog.datasea.in/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>





<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Code</h3>
    </div>
    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="https://github.com/engti/analytics_segment_overlap"><i class="fa fa-code-fork"></i> Github Link</a>
            </li>
        </ul>
    </div>
</div>    





<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="/categories/analytics"><i class="fa fa-folder"></i>analytics (1)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="/tags/adobe_analytics"><i class="fa fa-tags"></i> adobe_analytics</a>
            </li>
            
            <li><a href="/tags/rstats"><i class="fa fa-tags"></i> rstats</a>
            </li>
            
            <li><a href="/tags/segments"><i class="fa fa-tags"></i> segments</a>
            </li>
            
        </ul>
    </div>
</div>





                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>About us</h4>

            Rushed thoughts on site analytics enablement, reporting and analysis, personalisation.

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/2017/12/26/adobe_analytics-auto_generate_segments/">
                          
                            <img src="/img/banners/banner-2.jpg" class="img-responsive" alt="Adobe Analytics API: Automated Segment Generation">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/2017/12/26/adobe_analytics-auto_generate_segments/">Adobe Analytics API: Automated Segment Generation</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="/blog/">
                          
                            <img src="/img/placeholder.png" class="img-responsive" alt="Blogs">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="/blog/">Blogs</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>Contact</h4>

            <strong>Robin Browne</strong>
        <br>Bangalore
        <br>Karnataka
        <br>560 048
        <br>
        <strong>India</strong>
      </p>
      


            <a href="/contact" class="btn btn-small btn-template-main">Go to contact page</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2017, Robin Browne; all rights reserved.</p>
            
            <p class="pull-right">
              Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyCGlVQJmwATAZivFbzHqrxOk0gsqwhWkX4&v=3.exp"></script>

<script src="/js/hpneo.gmaps.js"></script>
<script src="/js/gmaps.init.js"></script>
<script src="/js/front.js"></script>


<script src="/js/owl.carousel.min.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>


  </body>
</html>
